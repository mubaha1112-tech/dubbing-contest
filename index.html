<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>åŠ±æ­¥ - Firstleap Voice Magic</title>
  
  <!-- æ ¸å¿ƒä¼˜åŒ–ï¼šé¢„åŠ è½½å›¾ç‰‡ï¼Œæå‡åŠ è½½ä¼˜å…ˆçº§ -->
  <link rel="preload" href="intro.png" as="image">

  <style>
    :root {
      --bg-cream: #F9F6E8;
      --card-white: #ffffff;
      --monster-green: #7BC043;
      --rabbit-pink: #FF8E8E;
      --rabbit-red: #EE5253;
      --pear-yellow: #F9CA24;
      --text-dark: #2d3436;
      --shadow-soft: 0 10px 30px rgba(249, 202, 36, 0.15);
      --shadow-3d: 0 6px 0 rgba(0,0,0,0.1);
    }

    body {
      font-family: "Chalkboard SE", "Comic Sans MS", -apple-system, BlinkMacSystemFont, sans-serif;
      background-color: var(--bg-cream);
      margin: 0;
      padding: 20px 10px;
      text-align: center;
      color: var(--text-dark);
      overscroll-behavior-y: contain; 
    }

    .container {
      background: var(--card-white);
      padding: 25px 20px;
      border-radius: 30px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.08);
      max-width: 600px;
      margin: 0 auto;
      position: relative;
      border: 5px solid #fff;
      transition: all 0.3s ease;
    }

    /* æ¬¢è¿é¡µæ ·å¼ */
    .welcome-screen {
      position: fixed;
      inset: 0;
      z-index: 100000;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(1200px 600px at 50% -10%, #ffb3b3, #ff6f6f, #f38181 60%, #111 100%);
      overflow: hidden;
      opacity: 1;
      transition: opacity .6s ease, visibility .6s ease;
      visibility: visible;
    }
    .welcome-screen.hidden {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
    }
    .welcome-bgvideo {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: saturate(1.1) contrast(1.05) brightness(0.9);
    }
    .welcome-overlay {
      position: relative;
      z-index: 2;
      text-align: center;
      color: #fff;
      padding: 20px;
    }
    .welcome-title {
      font-weight: 900;
      font-size: 34px;
      letter-spacing: 1px;
      text-shadow: 3px 3px 0 rgba(0,0,0,0.18);
    }
    .welcome-subtitle {
      margin-top: 8px;
      font-size: 16px;
      opacity: .95;
    }
    .welcome-cta {
      margin-top: 18px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      border-radius: 999px;
      background: rgba(255,255,255,0.18);
      color: #fff;
      font-weight: 800;
      border: 1px solid rgba(255,255,255,0.35);
      backdrop-filter: blur(6px);
      cursor: pointer;
    }

    /* æ ‡é¢˜ */
    h1 {
      color: var(--rabbit-red);
      font-size: 26px;
      margin: 10px 0 25px;
      text-shadow: 2px 2px 0px #ffe3e3;
      font-weight: 900;
      letter-spacing: 1px;
      position: relative;
      display: inline-block;
    }
    h1::after { content: "âœ¨"; position: absolute; right: -25px; top: 0; font-size: 20px; animation: bounce 2s infinite; }
    h1::before { content: "ğŸµ"; position: absolute; left: -25px; top: 10px; font-size: 20px; animation: bounce 2s infinite reverse; }

    /* æ§ä»¶æ ·å¼ */
    .step-label {
      text-align: left;
      margin: 15px 0 5px 5px;
      font-weight: bold;
      color: #888;
      font-size: 14px;
      display: flex;
      align-items: center;
    }
    .step-badge {
      background: var(--pear-yellow);
      color: #fff;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-right: 8px;
      font-size: 12px;
    }
    select {
      width: 100%;
      padding: 14px;
      margin-bottom: 10px;
      border: 2px solid #eee;
      border-radius: 18px;
      font-size: 16px;
      background: #fafafa;
      outline: none;
      transition: 0.3s;
      color: #555;
      font-weight: bold;
      -webkit-appearance: none;
    }

    .btn {
      display: block;
      width: 100%;
      padding: 16px;
      border: none;
      border-radius: 25px;
      font-size: 18px;
      font-weight: 800;
      cursor: pointer;
      color: white;
      margin-top: 15px;
      transition: all 0.2s;
      box-shadow: var(--shadow-3d);
      position: relative;
      overflow: hidden;
    }
    .btn:active { transform: translateY(4px); box-shadow: 0 2px 0 rgba(0,0,0,0.1); }
    .btn-primary { background: linear-gradient(135deg, #a8e063 0%, #56ab2f 100%); }
    
    /* ç¦ç”¨çŠ¶æ€æ ·å¼ */
    .btn:disabled, .btn[disabled] {
      background: #cccccc;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
      color: #888;
    }

    .btn-play {
      background: linear-gradient(135deg, #fce38a 0%, #f38181 100%);
      display: none; margin-bottom: 10px; color: #fff; text-shadow: 1px 1px 0 rgba(0,0,0,0.1);
    }
    .btn-record-mode { 
      background: linear-gradient(to right, #ff5f6d, #ffc371); 
      display: none; 
    }

    /* è§†é¢‘åŒºåŸŸ */
    #video-container { margin-top: 25px; display: none; position: relative; min-height: 200px; }
    video {
      width: 100%;
      border-radius: 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
      background: #000;
      outline: none;
      border: 4px solid #fff;
      object-fit: contain;
    }
    
    .status-text { margin-top: 15px; font-weight: bold; color: var(--rabbit-red); min-height: 24px; font-size: 15px; }
    .tip {
      font-size: 13px; color: #e67e22; margin-top: 12px; background: #fff3e0; padding: 12px; border-radius: 15px;
      box-shadow: inset 0 0 5px rgba(0,0,0,0.05); text-align: left;
    }

    /* --- çº¯å‡€å½•å±æ¨¡å¼ (Clean Recording Mode) --- */
    body.clean-mode { 
        background: #000; overflow: hidden; padding: 0; 
    }
    body.clean-mode .container {
        max-width: 100%; height: 100vh; margin: 0; padding: 0;
        border: none; border-radius: 0; background: #000;
        display: flex; flex-direction: column; justify-content: center;
    }
    body.clean-mode h1, 
    body.clean-mode .step-label, 
    body.clean-mode select, 
    body.clean-mode #searchBtn, 
    body.clean-mode #playBtn, 
    body.clean-mode #actionBtn,
    body.clean-mode .tip,
    body.clean-mode .status-text { 
        display: none !important; 
    }
    
    body.clean-mode #video-container {
        display: flex !important;
        width: 100%; height: 100%;
        margin: 0;
        background: #000;
        align-items: center; justify-content: center;
    }
    body.clean-mode video {
        border: none; box-shadow: none; border-radius: 0;
        max-height: 100vh; width: 100%; height: 100%;
    }
    /* å¼ºåˆ¶éšè—è§†é¢‘åŸç”Ÿæ§ä»¶ */
    body.clean-mode video::-webkit-media-controls { display: none !important; }

    /* Intro å›¾ç‰‡å±‚ - ä¼˜åŒ–ï¼šå¢åŠ æ–‡å­—å…œåº• */
    #introLayer {
        position: fixed; inset: 0; background: #000; z-index: 50;
        display: none; align-items: center; justify-content: center;
        flex-direction: column;
        color: #fff;
    }
    /* å›¾ç‰‡åœ¨åŠ è½½å‰éšè—ï¼ŒåŠ è½½åæ˜¾ç¤º */
    #introLayer img { 
        width: 100%; height: 100%; 
        object-fit: contain; 
        max-width: 100vw; max-height: 100vh;
        position: absolute; top:0; left:0;
        z-index: 2;
    }
    /* å…œåº•æ–‡å­—ï¼Œåœ¨å›¾ç‰‡åŠ è½½æ…¢æ—¶æ˜¾ç¤º */
    .intro-fallback-text {
        z-index: 1;
        font-size: 24px;
        font-weight: bold;
        color: #EE5253;
        animation: pulse 1s infinite alternate;
    }

    /* æ‚¬æµ®æ§åˆ¶æŒ‰é’®ï¼ˆä»…åœ¨çº¯å‡€æ¨¡å¼æ˜¾ç¤ºï¼‰ */
    #cleanControls {
        position: fixed;
        top: 20px; right: 20px;
        z-index: 60; 
        display: none; 
        gap: 15px;
    }
    .float-btn {
        background: rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(5px);
        border: 1px solid rgba(255,255,255,0.3);
        color: #fff;
        width: 44px; height: 44px;
        border-radius: 50%;
        font-size: 20px;
        display: flex; align-items: center; justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
    }
    .float-btn:active { transform: scale(0.9); background: rgba(0,0,0,0.6); }
    .float-btn-exit { background: rgba(238, 82, 83, 0.5); } 

    /* å¼¹çª—é€šç”¨æ ·å¼ */
    .overlay-fullscreen {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.92);
        z-index: 99999; display: none; align-items: center; justify-content: center; 
        flex-direction: column; padding: 20px; box-sizing: border-box;
    }
    .guide-card {
        background: #fff; color: #333; padding: 30px; border-radius: 20px;
        max-width: 90%; width: 400px; text-align: center;
    }
    .guide-step {
        text-align: left; margin: 20px 0; font-size: 16px; line-height: 1.6;
    }
    .guide-icon { font-size: 40px; margin-bottom: 10px; display: block; text-align: center; }
    .highlight { color: var(--rabbit-red); font-weight: bold; }

    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
    @keyframes pulse { from { opacity: 0.6; } to { opacity: 1; } }

    /* å½©è›‹åŠ¨ç”» */
    .monster-gift { font-size: 60px; animation: jumpHappy 1s infinite alternate; }
    @keyframes jumpHappy { 0% { transform: translateY(0) rotate(-10deg); } 100% { transform: translateY(-20px) rotate(10deg); } }

  </style>
</head>
<body class="welcome-active">

  <!-- æ¬¢è¿é¡µ -->
  <div id="welcome" class="welcome-screen">
    <video id="welcomeVideo" class="welcome-bgvideo" muted autoplay playsinline loop>
      <source src="opener.mp4" type="video/mp4">
    </video>
    <div class="welcome-overlay">
      <div class="welcome-title">Firstleap Voice Magic</div>
      <div class="welcome-subtitle">é…éŸ³ç§€</div>
      <div style="margin-top:20px;">
        <button id="welcomeEnterBtn" class="welcome-cta">è¿›å…¥ä½“éªŒ â–¶</button>
      </div>
    </div>
  </div>

  <!-- å½•å±å¼•å¯¼å¼¹çª— -->
  <div id="recordGuideOverlay" class="overlay-fullscreen">
    <div class="guide-card">
      <div class="guide-icon">ğŸ“±ğŸ™ï¸</div>
      <h2 style="margin:0 0 10px 0;">å‡†å¤‡å½•åˆ¶</h2>
      <div class="guide-step">
        1. è¯·ä¸‹æ‹‰æ‰‹æœºæ§åˆ¶ä¸­å¿ƒï¼Œå¼€å¯ <span class="highlight">å±å¹•å½•åˆ¶</span>ã€‚<br>
        <span class="highlight">âš ï¸ç¡®ä¿æ‰“å¼€â€œéº¦å…‹é£å£°éŸ³â€</span>æˆ–<span class="highlight">â€œç³»ç»Ÿå£°éŸ³â€</span><br><br>
        2. å¼€å¯å½•å±åï¼Œç‚¹å‡»ä¸‹æ–¹çš„ <b>GO</b> æŒ‰é’®ã€‚<br><br>
        3. è§†é¢‘å°†å…¨å±æ’­æ”¾ï¼Œè¯·å¼€å§‹æ‚¨çš„é…éŸ³è¡¨æ¼”ï¼
      </div>
      
      <!-- ä¼˜åŒ–ï¼šç§»é™¤ disabled å±æ€§ï¼Œä¸è®©ç”¨æˆ·ç­‰å¾…å›¾ç‰‡åŠ è½½ -->
      <button id="realStartBtn" class="btn btn-primary" onclick="startCleanModeReal()">ğŸš€ GO! å¼€å§‹æ’­æ”¾</button>
      
      <button class="btn" style="background:#eee; color:#666; box-shadow:none; margin-top:10px;" onclick="closeGuide()">å–æ¶ˆ</button>
    </div>
  </div>

  <!-- ç»“æŸæç¤ºå¼¹çª— -->
  <div id="finishOverlay" class="overlay-fullscreen">
    <div class="guide-card">
      <div class="guide-icon">ğŸ‰âœ‚ï¸</div>
      <h2 style="margin:0 0 10px 0;">å½•åˆ¶å®Œæˆ</h2>
      <div class="guide-step" style="text-align: center;">
        è¯·åˆ°æ‰‹æœºç›¸å†ŒæŸ¥çœ‹åˆšæ‰çš„å½•å±è§†é¢‘ï¼Œ<br>å¹¶<span class="highlight">å‘é€ç»™è€å¸ˆè¿›è¡Œå‰ªè£</span>ã€‚
      </div>
      <button class="btn btn-primary" onclick="closeFinishOverlay()">çŸ¥é“äº†</button>
    </div>
  </div>
  
  <!-- å½©è›‹å¼¹çª— -->
  <div id="eggOverlay" class="overlay-fullscreen" style="background: rgba(0,0,0,0.95); z-index: 100001;">
    <div style="font-size: 80px; margin-bottom: 20px;">ğŸ‰</div>
    <div style="color: #FFD700; font-size: 22px; font-weight:bold; margin-bottom:10px;">æ­å–œå‘ç°å½©è›‹ï¼æˆªå›¾å‘é€ç»™è€å¸ˆå§ï¼</div>
    <div style="display: flex; gap: 20px; margin: 20px 0;">
      <div class="monster-gift">ğŸ‘¾</div><div class="monster-gift" style="animation-delay: 0.1s">ğŸ‘¾</div><div class="monster-gift" style="animation-delay: 0.2s">ğŸ‘¾</div>
    </div>
    <button class="btn btn-primary" onclick="document.getElementById('eggOverlay').style.display='none'" style="width: 200px;">æ”¶ä¸‹å¥–åŠ±</button>
  </div>

  <!-- çº¯å‡€æ¨¡å¼æ‚¬æµ®æ§åˆ¶ -->
  <div id="cleanControls">
    <div class="float-btn" id="cleanPauseBtn" onclick="toggleCleanPause()">â¸ï¸</div>
    <div class="float-btn float-btn-exit" onclick="exitCleanMode(false)">ğŸšª</div>
  </div>

  <!-- ä¸»å®¹å™¨ -->
  <div class="container">
    <h1>Firstleap Voice Magic<br><span style="font-size:18px; color:#888; font-weight:normal;">é…éŸ³ç§€</span></h1>

    <div class="step-label"><span class="step-badge">1</span>é€‰æ‹©çº§åˆ«</div>
    <select id="levelSelect" onchange="updateUnits()">
      <option value="">è¯·é€‰æ‹©çº§åˆ« (Level)</option>
    </select>

    <div class="step-label"><span class="step-badge">2</span>é€‰æ‹©å•å…ƒ</div>
    <select id="unitSelect" disabled>
      <option value="">è¯·å…ˆé€‰æ‹©çº§åˆ«</option>
    </select>

    <button class="btn btn-primary" id="searchBtn" onclick="findVideo()">ğŸ¬ æŸ¥æ‰¾è§†é¢‘ Find Video</button>

    <!-- è§†é¢‘æ’­æ”¾åŒº -->
    <div id="video-container">
      <!-- Intro è¦†ç›–å±‚ (å›¾ç‰‡ä½¿ç”¨intro.png) -->
      <div id="introLayer">
        <!-- ä¼˜åŒ–ï¼šå¢åŠ å…œåº•æ–‡å­— -->
        <div class="intro-fallback-text">Firstleap Voice Magic</div>
        <img src="intro.png" alt="Intro" id="introImgElement">
      </div>
      
      <video id="mainVideo"
             playsinline
             webkit-playsinline
             x5-playsinline
             controls
             controlsList="nodownload"
             x5-video-player-type="h5-page">
        <source src="" type="video/mp4">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ ‡ç­¾ã€‚
      </video>

      <div class="status-text" id="statusText"></div>

      <!-- æç¤ºä¿¡æ¯ -->
      <div class="tip">
        ğŸ’¡ <b>é…éŸ³å°è´´å£«ï¼š</b><br>
        ç‚¹å‡»ä¸‹æ–¹â€œå¼€å§‹å½•åˆ¶æ¨¡å¼â€åï¼Œè§†é¢‘å°†å…¨å±æ’­æ”¾ã€‚è¯·é…åˆæ‰‹æœºè‡ªå¸¦çš„ã€å½•å±åŠŸèƒ½ã€‘è¿›è¡Œå½•åˆ¶ã€‚
      </div>

      <!-- æ“ä½œæŒ‰é’® -->
      <button class="btn btn-play" id="playBtn" onclick="togglePreview()">â–¶ï¸ é¢„è§ˆè§†é¢‘ Preview</button>
      <button class="btn btn-record-mode" id="actionBtn" onclick="showRecordGuide()">ğŸ”´ è¿›å…¥å½•å±æ¨¡å¼ (Record Mode)</button>
    </div>
  </div>

  <script>
    // --- ä¼˜åŒ–ï¼šéé˜»å¡å¼é¢„åŠ è½½ ---
    // ä¾ç„¶åˆ›å»º Image å¯¹è±¡è¿›è¡Œç¼“å­˜ï¼Œä½†ä¸å†æ§åˆ¶æŒ‰é’®çŠ¶æ€
    const preloadIntroImage = new Image();
    preloadIntroImage.src = 'intro.png';

    // --- æ•°æ®é…ç½® ---
    const videoDatabase = {
      "K2A": [
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763011941537284494.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763011945233cae631.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/17630119516450a277c.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763012048115b61f0f.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/2b63bb6d3c08490db6dd9d2b4fe656d7/teacher-homework/1763012051505623f0e.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/cc581b40f6b342ab8766ecb497b0593c/teacher-homework/17630120579742d4c02.mp4"
      ],
      "K2B": [
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/75c7beb9392e4cf9960c6eede634c52c/teacher-homework/17630120691122d5403.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/19d99dbee57a4f91a48ce6ce7bb974b4/teacher-homework/1763012082809a8b161.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/6ca4b573c3a74e009339b0d119d2c6b2/teacher-homework/17630121046921c4cc5.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/176301780297880646f.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/17630178108970b8c1a.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/176301781737859c176.mp4"
      ],
      "K3A": [
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/17630178328878ac20f.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/87f8ebf82ac44720a8ed695edc81d7db/teacher-homework/17630178426408a59d8.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/06f5c3edcb4d4d87ad1b0cd1d2993d27/teacher-homework/17630178665677d79d3.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251126/1764160538592e2c49d.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/63972810b527498d9402d45faea7bf43/teacher-homework/17630179827650c9812.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/00a0f094ef8244389261d996abd604b4/teacher-homework/1763017985597814ea5.mp4"
      ],
      "K3B": [
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763018186532db70f3.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/176301818877214d863.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763018191225723509.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763018193813bf765d.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763018196433b9f19e.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763018210633b0c5c5.mp4"
      ],
      "G0": [
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/17630182202811ca8fd.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763018228073dedc05.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763018230212beeb84.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763018576703e8a76d.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763018581832b7e3ea.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763018585472d3a0b3.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763018589064cbe157.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763018591548a9cde4.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/17630186018727ef726.mp4"
      ],
      "G1A": [
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763020933347b4721b.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/176302093584897e05c.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251126/1764158748310d16322.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/813136336eb34eb9a086f0e4c74fad8f/teacher-homework/1764158754953d7e3aa.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/c693f13409b0418aa30b61775fb667f2/teacher-homework/176415875781008bc3f.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/efe922c6dad3478194454c6f20e83594/teacher-homework/176415876014857f8ce.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251126/1764161806814c6027c.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/620f34d23da24485b7b3ebecf0d49715/teacher-homework/1764161810873e2ec8d.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/61ec2562d76343898d1a4d622dfe53ba/teacher-homework/1764158765004679961.mp4"
      ],
      "G1B": [
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763021337298aae2a8.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/176302134040302afa2.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763021343327574ffe.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763021345500e16489.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763021348021750704.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/176302135256081bc9e.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763021362061eb0385.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763021363940857b8e.mp4"
      ],
      "G2A": [
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251126/1764160519134278b5d.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251126/1764160529270565a19.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/9083ce4b5f4242bdac85816e04e0bc56/teacher-homework/1763021929116e2169c.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/9af16032c9154a31bf2a95b3b15d1025/teacher-homework/176302193109956c2ed.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/51ae315a5c2b4260ba674f0dd1bdf11f/teacher-homework/17641618194078a0e28.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251126/1764160535355cf6285.mp4"
      ],
      "G2B": [
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/c273f4a79c2845a59ed38b42b95f07c9/teacher-homework/1763022250827a260c7.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/2d998f0708574253aa892ba9d2ad0aea/teacher-homework/17630222531960ecf7c.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/17630222556756ffc34.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/176302225764940fec6.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251126/1764157788986ab1382.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251126/1764157791475e09b7e.mp4"
      ],
      "G3A": [
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251126/1764160084181f102c7.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/4402ca889ef3400b839ef84cb23d12d3/teacher-homework/1763022952100285191.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251126/1764160086821b8d9e2.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/fdceaef6e31e4c638822a048c10725f8/teacher-homework/1764160089326b7fb73.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251126/17641600922812b7bff.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/a8c7a19a8cba42edaf6986b94969b197/teacher-homework/176416009474092babe.mp4"
      ],
      "G3B": [
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/176302346811779ef05.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/176302347129269b324.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763023473567337000.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763023475693e477da.mp4"
      ],
      "G4A": [
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/c03eed96e6704a3f9e2e69aa87c5d129/teacher-homework/1763023607589e0edf8.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/eddede32bb134a7b9b459da4a265cb3d/teacher-homework/176302361198451fd60.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/058ccf2fb9b44db9b36af29fa2a3d049/teacher-homework/1763023619529830ebc.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/b2f0f75f1b734391a001882ca73c60cb/teacher-homework/17630236219657ae294.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251126/1764158042333492fc3.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/video/20251113/1763023992804c614a5.mp4"
      ],
      "G4B": [
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/ea4be2c59c024dea923d9806e1f7250a/teacher-homework/176302071175214eb09.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/f5abe75bd2ba4a03aecc16901b13e497/teacher-homework/1763020714062726936.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/7a60f558b9ac4428b9aa08f196cdbc20/teacher-homework/17630207163663000fa.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/febd1d55be274f3e911b4cc9aa9d7f88/teacher-homework/176302072522770462f.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/22a7ca3d786c495c96226e04473035cd/teacher-homework/176302072735125fd25.mp4",
        "https://file-aliyun.firstleap.cn/homework/teacher/transcoded/9c4b0954c98c4568a47cd7078e27cc6f/teacher-homework/176302072937414367d.mp4"
      ]
    };

    // --- æ¬¢è¿é¡µé€»è¾‘ ---
    (function setupWelcome() {
      const welcome = document.getElementById('welcome');
      const wVideo = document.getElementById('welcomeVideo');
      const enterBtn = document.getElementById('welcomeEnterBtn');
      
      enterBtn.addEventListener('click', () => {
        welcome.classList.add('hidden');
        document.body.classList.remove('welcome-active');
        try { wVideo.pause(); } catch(e){}
        setTimeout(() => welcome.style.display = 'none', 650);
      });
    })();

    // --- åˆå§‹åŒ–ä¸‹æ‹‰èœå• ---
    const levels = Object.keys(videoDatabase);
    const levelSelect = document.getElementById("levelSelect");
    levels.forEach(lvl => {
      let option = document.createElement("option");
      option.value = lvl;
      option.text = lvl;
      levelSelect.appendChild(option);
    });

    function updateUnits() {
      const lvl = document.getElementById("levelSelect").value;
      const unitSelect = document.getElementById("unitSelect");
      unitSelect.innerHTML = '<option value="">-- è¯·é€‰æ‹©å•å…ƒ (Unit) --</option>';
      unitSelect.disabled = true;

      if (lvl && videoDatabase[lvl]) {
        let hasUnits = false;
        for (let i = 0; i < videoDatabase[lvl].length; i++) {
          if (videoDatabase[lvl][i]) {
            let option = document.createElement("option");
            option.value = i;
            option.text = "Unit " + (i + 1);
            unitSelect.appendChild(option);
            hasUnits = true;
          }
        }
        if(hasUnits) unitSelect.disabled = false;
      }
    }

    // --- æŸ¥æ‰¾è§†é¢‘ ---
    function findVideo() {
      const lvl = document.getElementById("levelSelect").value;
      const unitIndex = document.getElementById("unitSelect").value;
      const videoContainer = document.getElementById("video-container");
      const videoPlayer = document.getElementById("mainVideo");
      const playBtn = document.getElementById("playBtn");
      const actionBtn = document.getElementById("actionBtn");

      if (!lvl || unitIndex === "") {
        alert("è¯·å…ˆé€‰æ‹©çº§åˆ«å’Œå•å…ƒï¼");
        return;
      }

      const url = videoDatabase[lvl][unitIndex];
      videoContainer.style.display = "block";
      videoPlayer.src = url;
      videoPlayer.load();
      videoPlayer.controls = true; // é¢„è§ˆæ—¶æ˜¾ç¤ºæ§ä»¶
      
      playBtn.style.display = "block";
      playBtn.innerHTML = "â–¶ï¸ é¢„è§ˆè§†é¢‘ Preview";
      actionBtn.style.display = "block";
      
      document.getElementById("statusText").innerText = "âœ… è§†é¢‘å°±ç»ªï¼Œå¯é¢„è§ˆæˆ–å¼€å§‹å½•åˆ¶";
      
      videoPlayer.onended = function() {
        playBtn.innerHTML = "â–¶ï¸ é¢„è§ˆè§†é¢‘ Preview";
      };

      videoContainer.scrollIntoView({behavior: "smooth"});
    }

    // --- é¢„è§ˆåŠŸèƒ½ ---
    function togglePreview() {
      const video = document.getElementById("mainVideo");
      const btn = document.getElementById("playBtn");
      if (video.paused) {
        video.play();
        btn.innerHTML = "â¸ï¸ æš‚åœé¢„è§ˆ Pause";
      } else {
        video.pause();
        btn.innerHTML = "â–¶ï¸ ç»§ç»­é¢„è§ˆ Preview";
      }
    }

    // --- çº¯å‡€å½•å±æ¨¡å¼é€»è¾‘ ---
    
    // 1. æ˜¾ç¤ºå¼•å¯¼å¼¹çª—
    function showRecordGuide() {
      const video = document.getElementById("mainVideo");
      if(video.readyState < 1 && !video.src) {
        alert("è¯·å…ˆåŠ è½½è§†é¢‘");
        return;
      }
      // æš‚åœå¯èƒ½æ­£åœ¨è¿›è¡Œçš„é¢„è§ˆ
      video.pause();
      video.currentTime = 0;
      
      document.getElementById('recordGuideOverlay').style.display = 'flex';
    }

    function closeGuide() {
      document.getElementById('recordGuideOverlay').style.display = 'none';
    }

    // 2. çœŸæ­£å¼€å§‹ï¼šè¿›å…¥å…¨å±ï¼Œæ’­æ”¾Introï¼Œç„¶åæ’­æ”¾è§†é¢‘
    function startCleanModeReal() {
      closeGuide();
      
      // è¿›å…¥å…¨å±æ ·å¼æ¨¡å¼
      document.body.classList.add('clean-mode');
      
      const video = document.getElementById("mainVideo");
      const intro = document.getElementById("introLayer");
      const controls = document.getElementById("cleanControls");
      
      // å°è¯•è¿›å…¥æµè§ˆå™¨åŸç”Ÿå…¨å±
      const docElm = document.documentElement;
      if (docElm.requestFullscreen) { docElm.requestFullscreen().catch(()=>{}); }
      else if (docElm.webkitRequestFullScreen) { docElm.webkitRequestFullScreen().catch(()=>{}); }
      
      // å°è¯•å¼ºåˆ¶æ¨ªå± (å¦‚æœæµè§ˆå™¨æ”¯æŒ)
      try {
        if (screen.orientation && screen.orientation.lock) {
          screen.orientation.lock('landscape').catch(err => {
            console.log("Landscape lock not supported/allowed on this device", err);
          });
        }
      } catch(e) {}

      // å¼ºåˆ¶éšè—æ§ä»¶ï¼Œé˜²æ­¢å½•å±æ—¶å‡ºç°
      video.controls = false;
      
      // ç¡®ä¿æ‚¬æµ®æ§ä»¶å…ˆéšè—ï¼ˆä¸è¦æŒ¡ä½introï¼‰
      controls.style.display = "none";
      // é‡ç½®æš‚åœæŒ‰é’®å›¾æ ‡
      document.getElementById("cleanPauseBtn").innerText = "â¸ï¸";
      
      // æ˜¾ç¤º Intro å›¾ç‰‡
      intro.style.display = "flex";
      
      // ä½¿ç”¨ requestAnimationFrame ç¡®ä¿å›¾ç‰‡æ¸²æŸ“åå†å¼€å§‹å€’è®¡æ—¶
      requestAnimationFrame(() => {
        // è¿™é‡Œè®¾ç½®ä¸º 3000ms (3ç§’)
        setTimeout(() => {
          intro.style.display = "none";
          // æ˜¾ç¤ºæ‚¬æµ®æ§åˆ¶
          controls.style.display = "flex";
          
          // å¼€å§‹æ’­æ”¾è§†é¢‘
          video.play().then(() => {
            // è§†é¢‘æ’­æ”¾æˆåŠŸ
          }).catch(err => {
            alert("è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢ï¼Œè¯·ç‚¹å‡»å±å¹•å¼€å§‹");
          });
        }, 3000);
      });
      
      // è§†é¢‘æ’­æ”¾ç»“æŸåé€€å‡º
      video.onended = () => {
        exitCleanMode(true); // true è¡¨ç¤ºæ­£å¸¸æ’­æ”¾ç»“æŸ
      };
    }

    // æ‚¬æµ®æŒ‰é’®åŠŸèƒ½ï¼šæš‚åœ/ç»§ç»­
    function toggleCleanPause() {
        const video = document.getElementById("mainVideo");
        const btn = document.getElementById("cleanPauseBtn");
        if(video.paused) {
            video.play();
            btn.innerText = "â¸ï¸";
        } else {
            video.pause();
            btn.innerText = "â–¶ï¸";
        }
    }

    // 3. é€€å‡ºå½•å±æ¨¡å¼
    function exitCleanMode(finished = false) {
      document.body.classList.remove('clean-mode');
      document.getElementById("cleanControls").style.display = "none"; // éšè—æ‚¬æµ®æŒ‰é’®
      
      // é€€å‡ºåŸç”Ÿå…¨å±
      if (document.exitFullscreen) { document.exitFullscreen().catch(()=>{}); }
      else if (document.webkitCancelFullScreen) { document.webkitCancelFullScreen().catch(()=>{}); }
      
      // è§£é”å±å¹•æ–¹å‘
      try {
         if (screen.orientation && screen.orientation.unlock) {
            screen.orientation.unlock();
         }
      } catch(e) {}

      const video = document.getElementById("mainVideo");
      video.pause();
      video.currentTime = 0;
      video.controls = true; // æ¢å¤æ§ä»¶æ˜¾ç¤º
      // æ¢å¤ç»“æŸç›‘å¬ä¸ºé»˜è®¤
      video.onended = function() {
        document.getElementById("playBtn").innerHTML = "â–¶ï¸ é¢„è§ˆè§†é¢‘ Preview";
      };

      // å¦‚æœæ˜¯æ’­æ”¾ç»“æŸå¯¼è‡´çš„é€€å‡ºï¼Œæ˜¾ç¤ºæç¤ºå¼¹çª—
      if (finished) {
        document.getElementById("finishOverlay").style.display = "flex";
        document.getElementById("statusText").innerText = "âœ¨ å½•åˆ¶ç»“æŸï¼";
      }
    }

    // å…³é—­ç»“æŸæç¤ºå¼¹çª—
    function closeFinishOverlay() {
      document.getElementById("finishOverlay").style.display = "none";
    }

    // --- å½©è›‹é€»è¾‘ ---
    let titleClickCount = 0;
    let titleClickTimer = null;
    const titleElement = document.querySelector('h1');

    titleElement.addEventListener('click', function() {
      titleClickCount++;
      if (titleClickCount === 1) {
        titleClickTimer = setTimeout(() => { titleClickCount = 0; }, 2000);
      }
      if (titleClickCount === 3) {
        document.getElementById('eggOverlay').style.display = 'flex';
        titleClickCount = 0;
        clearTimeout(titleClickTimer);
      }
    });

  </script>
</body>
</html>
